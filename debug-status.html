<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ãƒãƒƒã‚° - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ†ã‚¹ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ”§ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ‡ãƒãƒƒã‚°</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">ç¾åœ¨ã®APIãƒ‡ãƒ¼ã‚¿</h2>
            <pre id="api-data" class="bg-gray-100 p-4 rounded text-sm overflow-auto"></pre>
            <button onclick="loadAPIData()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                APIãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿
            </button>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-bold mb-4">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ãƒ†ã‚¹ãƒˆ</h2>
            
            <div class="mb-4">
                <label class="block mb-2">ä¼šå“¡ID:</label>
                <input id="member-id" type="text" value="member_001" class="border p-2 rounded w-full">
            </div>
            
            <div class="mb-4">
                <label class="block mb-2">æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</label>
                <select id="new-status" class="border p-2 rounded w-full">
                    <option value="core">ã‚³ã‚¢</option>
                    <option value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</option>
                    <option value="peripheral">å‘¨è¾º</option>
                    <option value="at_risk">é›¢è„±äºˆå‚™è»</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block mb-2">æ–°ã—ã„ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—:</label>
                <select id="new-hero-step" class="border p-2 rounded w-full">
                    <option value="0">0: ç›®çš„</option>
                    <option value="1">1: ä¸»ä½“æ€§</option>
                    <option value="2">2: åˆæœŸè¡Œå‹•</option>
                    <option value="3">3: ãƒ†ãƒ¼ãƒæ±ºã‚</option>
                    <option value="4">4: ãƒªãƒ¼ãƒ€ãƒ¼</option>
                    <option value="5">5: ãƒ’ãƒ¼ãƒ­ãƒ¼</option>
                </select>
            </div>
            
            <div class="flex gap-4">
                <button onclick="updateStatus()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                </button>
                <button onclick="updateHeroStep()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°
                </button>
                <button onclick="updateBoth()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ä¸¡æ–¹æ›´æ–°
                </button>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-bold mb-4">å®Ÿè¡Œãƒ­ã‚°</h2>
            <div id="log" class="bg-gray-900 text-green-400 p-4 rounded text-sm font-mono h-64 overflow-auto"></div>
            <button onclick="clearLog()" class="mt-2 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                ãƒ­ã‚°ã‚¯ãƒªã‚¢
            </button>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLog() {
            logContainer.innerHTML = '';
        }
        
        async function loadAPIData() {
            try {
                log('ğŸ”„ APIãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–‹å§‹...');
                const response = await fetch('/api/members', {
                    headers: { 'X-User-Role': 'admin' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('api-data').textContent = JSON.stringify(data, null, 2);
                    log('âœ… APIãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†');
                } else {
                    log(`âŒ APIã‚¨ãƒ©ãƒ¼: ${response.status}`);
                }
            } catch (error) {
                log(`âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        async function updateStatus() {
            const memberId = document.getElementById('member-id').value;
            const newStatus = document.getElementById('new-status').value;
            
            try {
                log(`ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é–‹å§‹: ${memberId} â†’ ${newStatus}`);
                
                const response = await fetch(`/api/members/${memberId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Role': 'admin'
                    },
                    body: JSON.stringify({ engagement_status: newStatus })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log(`âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°æˆåŠŸ: ${JSON.stringify(result)}`);
                    
                    // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
                    setTimeout(loadAPIData, 500);
                } else {
                    const error = await response.json();
                    log(`âŒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°å¤±æ•—: ${JSON.stringify(error)}`);
                }
            } catch (error) {
                log(`âŒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        async function updateHeroStep() {
            const memberId = document.getElementById('member-id').value;
            const newHeroStep = parseInt(document.getElementById('new-hero-step').value);
            
            try {
                log(`ğŸ“ˆ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°é–‹å§‹: ${memberId} â†’ ${newHeroStep}`);
                
                const response = await fetch(`/api/members/${memberId}/hero-step`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-Role': 'admin'
                    },
                    body: JSON.stringify({ current_step: newHeroStep })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    log(`âœ… ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°æˆåŠŸ: ${JSON.stringify(result)}`);
                    
                    // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
                    setTimeout(loadAPIData, 500);
                } else {
                    const error = await response.json();
                    log(`âŒ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°å¤±æ•—: ${JSON.stringify(error)}`);
                }
            } catch (error) {
                log(`âŒ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        async function updateBoth() {
            await updateStatus();
            setTimeout(updateHeroStep, 300);
        }
        
        // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        window.addEventListener('DOMContentLoaded', loadAPIData);
    </script>
</body>
</html>