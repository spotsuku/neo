<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企業管理者ダッシュボード - NEO Digital Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'company': {
                            50: '#f0fdf4',
                            500: '#059669',
                            600: '#047857',
                            700: '#065f46'
                        },
                        'neo-blue': '#2563eb',
                        'neo-green': '#10b981',
                        'neo-orange': '#f59e0b',
                        'neo-purple': '#8b5cf6'
                    }
                }
            }
        }
    </script>
    <style>
        .company-gradient {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- 統一ヘッダー: 企業管理者ダッシュボード -->
    <nav class="bg-white shadow-lg border-b-2 border-company-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- ロゴとタイトル -->
                <div class="flex items-center space-x-4">
                    <div class="company-gradient text-white p-2 rounded-lg shadow-md">
                        <i class="fas fa-building text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">NEO Digital Platform</h1>
                        <p class="text-sm text-company-600 font-medium">企業管理者ダッシュボード</p>
                    </div>
                </div>

                <!-- ナビゲーションメニュー -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="/company-dashboard" class="text-company-700 font-medium border-b-2 border-company-500 pb-1">
                        <i class="fas fa-chart-line mr-2"></i>パフォーマンス
                    </a>
                    <a href="/company/hero-distribution" class="text-gray-600 hover:text-company-600 font-medium transition-colors">
                        <i class="fas fa-crown mr-2"></i>ヒーロー管理
                    </a>
                    <a href="/company/projects" class="text-gray-600 hover:text-company-600 font-medium transition-colors">
                        <i class="fas fa-project-diagram mr-2"></i>プロジェクト
                    </a>
                    <a href="/company/reports" class="text-gray-600 hover:text-company-600 font-medium transition-colors">
                        <i class="fas fa-file-alt mr-2"></i>レポート
                    </a>
                </div>

                <!-- ユーザーメニュー -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="notification-btn" class="relative p-2 text-gray-600 hover:text-company-600 transition-colors">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-bounce">2</span>
                        </button>
                    </div>
                    <div class="relative">
                        <button id="user-menu-btn" class="flex items-center space-x-2 text-gray-700 hover:text-company-600 transition-colors">
                            <div class="company-gradient text-white p-2 rounded-full shadow-md">
                                <i class="fas fa-building"></i>
                            </div>
                            <span class="font-medium hidden sm:block" id="company-name">テックコーポレーション</span>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        <!-- ドロップダウンメニュー -->
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                            <a href="/profile.html" class="block px-4 py-2 text-gray-700 hover:bg-company-50 transition-colors">
                                <i class="fas fa-building mr-2"></i>企業情報
                            </a>
                            <a href="/company/settings" class="block px-4 py-2 text-gray-700 hover:bg-company-50 transition-colors">
                                <i class="fas fa-cog mr-2"></i>設定
                            </a>
                            <a href="/company/billing" class="block px-4 py-2 text-gray-700 hover:bg-company-50 transition-colors">
                                <i class="fas fa-credit-card mr-2"></i>課金管理
                            </a>
                            <div class="border-t border-gray-200"></div>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">
                                <i class="fas fa-sign-out-alt mr-2"></i>ログアウト
                            </button>
                        </div>
                    </div>
                    
                    <!-- モバイルメニューボタン -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-600 hover:text-company-600 transition-colors">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- モバイルナビゲーション -->
            <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-gray-200">
                <div class="space-y-2 pt-4">
                    <a href="/company-dashboard" class="block text-company-700 font-medium px-2 py-2 rounded bg-company-50">
                        <i class="fas fa-chart-line mr-3"></i>パフォーマンス
                    </a>
                    <a href="/company/hero-distribution" class="block text-gray-600 hover:text-company-600 px-2 py-2 rounded hover:bg-company-50 transition-colors">
                        <i class="fas fa-crown mr-3"></i>ヒーロー管理
                    </a>
                    <a href="/company/projects" class="block text-gray-600 hover:text-company-600 px-2 py-2 rounded hover:bg-company-50 transition-colors">
                        <i class="fas fa-project-diagram mr-3"></i>プロジェクト
                    </a>
                    <a href="/company/reports" class="block text-gray-600 hover:text-company-600 px-2 py-2 rounded hover:bg-company-50 transition-colors">
                        <i class="fas fa-file-alt mr-3"></i>レポート
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- KPI統計カード -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-chart-line text-neo-blue mr-2"></i>
                派遣学生のパフォーマンス概要
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <!-- 派遣学生数 -->
                <div class="stat-card rounded-xl shadow-md p-6 card-hover border-l-4 border-blue-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">派遣学生数</p>
                            <p class="text-3xl font-bold text-blue-600">12名</p>
                        </div>
                        <i class="fas fa-users text-3xl text-blue-500"></i>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">前月比 +2名</p>
                </div>

                <!-- ヒーロー候補 -->
                <div class="stat-card rounded-xl shadow-md p-6 card-hover border-l-4 border-yellow-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">ヒーロー候補</p>
                            <p class="text-3xl font-bold text-yellow-600">3名</p>
                        </div>
                        <i class="fas fa-crown text-3xl text-yellow-500"></i>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">4次以上達成</p>
                </div>

                <!-- 平均成長スコア -->
                <div class="stat-card rounded-xl shadow-md p-6 card-hover border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">平均成長スコア</p>
                            <p class="text-3xl font-bold text-green-600">3.2</p>
                        </div>
                        <i class="fas fa-trophy text-3xl text-green-500"></i>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">業界平均 2.8</p>
                </div>

                <!-- プロジェクト参加率 -->
                <div class="stat-card rounded-xl shadow-md p-6 card-hover border-l-4 border-purple-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 text-sm">プロジェクト参加率</p>
                            <p class="text-3xl font-bold text-purple-600">89%</p>
                        </div>
                        <i class="fas fa-project-diagram text-3xl text-purple-500"></i>
                    </div>
                    <p class="text-sm text-gray-500 mt-2">目標 80%</p>
                </div>
            </div>
        </section>

        <!-- 派遣学生一覧とアクション -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- 派遣学生リスト -->
            <section class="bg-white rounded-xl shadow-md p-6 card-hover">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-list text-neo-blue mr-2"></i>
                        派遣学生一覧
                    </h3>
                    <button class="bg-neo-blue text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                        詳細レポート
                    </button>
                </div>

                <div class="space-y-4">
                    <div class="border-l-4 border-green-400 pl-4 py-3 bg-green-50 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">田中太郎</h4>
                                <p class="text-sm text-gray-600">4次：エキスパート | プロジェクトリーダー</p>
                            </div>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">優秀</span>
                        </div>
                    </div>

                    <div class="border-l-4 border-blue-400 pl-4 py-3 bg-blue-50 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">佐藤花子</h4>
                                <p class="text-sm text-gray-600">3次：リーダーシップ | チーム貢献度高</p>
                            </div>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">順調</span>
                        </div>
                    </div>

                    <div class="border-l-4 border-yellow-400 pl-4 py-3 bg-yellow-50 rounded-r-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="font-medium text-gray-800">鈴木一郎</h4>
                                <p class="text-sm text-gray-600">2次：アマチュア | スキル向上中</p>
                            </div>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">成長中</span>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <button class="text-neo-blue hover:text-blue-700 font-medium text-sm">
                            全員を見る (12名) →
                        </button>
                    </div>
                </div>
            </section>

            <!-- 最近のアクティビティ -->
            <section class="bg-white rounded-xl shadow-md p-6 card-hover">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-clock text-neo-green mr-2"></i>
                    最近のアクティビティ
                </h3>

                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-arrow-up text-green-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">田中太郎が4次に昇格</p>
                            <p class="text-sm text-gray-500">2時間前</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-project-diagram text-blue-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">新プロジェクト「AI開発」に3名参加</p>
                            <p class="text-sm text-gray-500">1日前</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-award text-purple-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">佐藤花子がリーダーシップバッジ獲得</p>
                            <p class="text-sm text-gray-500">2日前</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-comments text-orange-600"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">月次評価レポートが提出されました</p>
                            <p class="text-sm text-gray-500">3日前</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- アクションセクション -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-tasks text-neo-purple mr-2"></i>
                管理アクション
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- ヒーロー分布確認 -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="text-center">
                        <i class="fas fa-chart-pie text-4xl text-neo-blue mb-4"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">ヒーロー分布確認</h3>
                        <p class="text-gray-600 text-sm mb-4">派遣学生のスキルレベル分布と成長傾向を詳細に分析</p>
                        <button onclick="window.location.href='/company/hero-distribution.html'" class="w-full bg-neo-blue text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            分布を確認
                        </button>
                    </div>
                </div>

                <!-- 評価レポート作成 -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="text-center">
                        <i class="fas fa-file-alt text-4xl text-neo-green mb-4"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">評価レポート作成</h3>
                        <p class="text-gray-600 text-sm mb-4">個別学生の成長レポートを作成し、フィードバックを提供</p>
                        <button class="w-full bg-neo-green text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                            レポート作成
                        </button>
                    </div>
                </div>

                <!-- 新規プロジェクト提案 -->
                <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                    <div class="text-center">
                        <i class="fas fa-plus-circle text-4xl text-neo-orange mb-4"></i>
                        <h3 class="font-semibold text-gray-800 mb-2">新規プロジェクト提案</h3>
                        <p class="text-gray-600 text-sm mb-4">学生のスキル向上を目的とした新しいプロジェクトを企画・提案</p>
                        <button class="w-full bg-neo-orange text-white py-2 rounded-lg hover:bg-yellow-600 transition-colors">
                            プロジェクト提案
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 通知・連絡事項 -->
        <section class="bg-white rounded-xl shadow-md p-6 card-hover">
            <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-bullhorn text-neo-purple mr-2"></i>
                重要な通知・連絡事項
            </h3>

            <div class="space-y-4">
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-blue-800">新学期開始に伴う派遣学生オリエンテーション</h4>
                            <p class="text-blue-700 text-sm mt-1">9月5日 (火) 14:00〜 | 参加必須</p>
                        </div>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">必須</span>
                    </div>
                </div>

                <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded-r-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-green-800">Q2 成果発表会の開催案内</h4>
                            <p class="text-green-700 text-sm mt-1">各プロジェクトの成果を発表・評価する機会です</p>
                        </div>
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">案内</span>
                    </div>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-yellow-800">ヒーローステップ評価基準の更新</h4>
                            <p class="text-yellow-700 text-sm mt-1">より詳細で公平な評価システムに改善されました</p>
                        </div>
                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">更新</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- フッター固定ナビゲーション（企業管理者用） -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 z-40">
        <div class="flex justify-around max-w-md mx-auto">
            <button class="flex flex-col items-center py-2 px-3 text-neo-blue">
                <i class="fas fa-tachometer-alt text-lg mb-1"></i>
                <span class="text-xs">ダッシュボード</span>
            </button>
            <button class="flex flex-col items-center py-2 px-3 text-gray-500 hover:text-neo-blue transition-colors" onclick="window.location.href='/company/hero-distribution.html'">
                <i class="fas fa-users text-lg mb-1"></i>
                <span class="text-xs">人材分布</span>
            </button>
            <button class="flex flex-col items-center py-2 px-3 text-gray-500 hover:text-neo-blue transition-colors">
                <i class="fas fa-chart-bar text-lg mb-1"></i>
                <span class="text-xs">レポート</span>
            </button>
            <button class="flex flex-col items-center py-2 px-3 text-gray-500 hover:text-neo-blue transition-colors">
                <i class="fas fa-cog text-lg mb-1"></i>
                <span class="text-xs">設定</span>
            </button>
        </div>
    </nav>

    <script>
        // API連携とリアルタイム更新
        async function loadCompanyDashboardData() {
            try {
                // 派遣学生の分布データ取得
                const response = await fetch('/api/heroes-steps/analytics?company=テックコーポレーション');
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        updateDashboardStats(result.data);
                    }
                }
            } catch (error) {
                console.error('企業ダッシュボードデータの取得に失敗:', error);
            }
        }

        function updateDashboardStats(data) {
            // 統計情報の更新
            console.log('企業ダッシュボード統計更新:', data);
        }

        // 通知システム
        function setupCompanyNotifications() {
            const eventSource = new EventSource('/api/heroes-steps/stream');
            
            eventSource.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === 'hero_step_update' && data.company === 'テックコーポレーション') {
                    showNotification('派遣学生のヒーローステップが更新されました', 'info');
                    loadCompanyDashboardData();
                }
            };
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'warning' ? 'bg-yellow-500' : 
                'bg-blue-500'
            } text-white`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // 統一ヘッダーのイベントリスナー設定
        function setupUnifiedHeaderEvents() {
            // ユーザーメニューの切り替え
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userMenu = document.getElementById('user-menu');
            if (userMenuBtn && userMenu) {
                userMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userMenu.classList.toggle('hidden');
                });
            }
            
            // モバイルメニューの切り替え
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // 通知ボタン
            const notificationBtn = document.getElementById('notification-btn');
            if (notificationBtn) {
                notificationBtn.addEventListener('click', function() {
                    console.log('🔔 通知クリック - 企業ダッシュボード');
                    showNotification('新しい通知があります', 'info');
                });
            }
            
            // 外側クリックでメニューを閉じる
            document.addEventListener('click', function(e) {
                if (userMenu && !userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
            });
        }
        
        // ログアウト機能
        function logout() {
            console.log('👋 ログアウト中...');
            // 実装: 認証解除処理
            if (window.authManager) {
                window.authManager.logout();
            }
            window.location.href = '/login.html';
        }

        // ページ初期化
        document.addEventListener('DOMContentLoaded', function() {
            loadCompanyDashboardData();
            setupCompanyNotifications();
            setupUnifiedHeaderEvents();
            
            console.log('🏢 企業管理者ダッシュボード読み込み完了');
        });
    </script>
</body>
</html>