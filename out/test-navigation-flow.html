<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ - NEO Digital Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/auth.js"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª</h2>
            <div class="space-y-3 text-sm">
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">1</span>
                    <span>ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">2</span>
                    <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§KPIç¢ºèª</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">3</span>
                    <span>ä¼šå“¡ç·æ•°KPIã‚¯ãƒªãƒƒã‚¯ â†’ å…¨ä¼šå“¡ä¸€è¦§</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">4</span>
                    <span>é›¢è„±äºˆå‚™è»KPIã‚¯ãƒªãƒƒã‚¯ â†’ é›¢è„±äºˆå‚™è»ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs">5</span>
                    <span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã§æˆ»ã‚‹</span>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">1. èªè¨¼ãƒ†ã‚¹ãƒˆ</h3>
                <button onclick="testAdminLogin()" class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
                </button>
                <div id="auth-status" class="mt-2 text-sm text-gray-600">æœªãƒ­ã‚°ã‚¤ãƒ³</div>
            </div>
            
            <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç§»å‹• -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
                <button onclick="goToDashboard()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
                </button>
                <div class="mt-2 text-xs text-gray-500">KPIç¢ºèªã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</div>
            </div>
            
            <!-- å…¨ä¼šå“¡ä¸€è¦§ -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">3. å…¨ä¼šå“¡ä¸€è¦§</h3>
                <button onclick="goToAllMembers()" class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    å…¨ä¼šå“¡è¡¨ç¤º
                </button>
                <div class="mt-2 text-xs text-gray-500">ä¼šå“¡ç·æ•°KPIã¨åŒã˜å‹•ä½œ</div>
            </div>
            
            <!-- é›¢è„±äºˆå‚™è» -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">4. é›¢è„±äºˆå‚™è»</h3>
                <button onclick="goToAtRiskMembers()" class="w-full bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    é›¢è„±äºˆå‚™è»è¡¨ç¤º
                </button>
                <div class="mt-2 text-xs text-gray-500">é›¢è„±äºˆå‚™è»KPIã¨åŒã˜å‹•ä½œ</div>
            </div>
            
            <!-- KPIåŒæœŸãƒ†ã‚¹ãƒˆ -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">5. KPIç¢ºèª</h3>
                <button onclick="checkKPI()" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    KPIæ•°å€¤ç¢ºèª
                </button>
                <div id="kpi-info" class="mt-2 text-xs text-gray-500">KPIå–å¾—ä¸­...</div>
            </div>
            
            <!-- ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ -->
            <div class="bg-white p-4 rounded-lg shadow">
                <h3 class="font-semibold mb-3">6. ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</h3>
                <button onclick="testLogout()" class="w-full bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </button>
                <div class="mt-2 text-xs text-gray-500">ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢</div>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow mt-6">
            <h2 class="text-xl font-semibold mb-4">ãƒ†ã‚¹ãƒˆçµæœãƒ­ã‚°</h2>
            <div id="test-log" class="text-sm font-mono bg-gray-100 p-4 rounded min-h-32 max-h-64 overflow-y-auto">
                ãƒ†ã‚¹ãƒˆé–‹å§‹æº–å‚™ä¸­...
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function testAdminLogin() {
            log('ğŸ” ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            if (!window.authManager) {
                log('âŒ authManagerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            const result = window.authManager.quickLogin('admin@neo.com', 'password123');
            
            if (result.success) {
                log('âœ… ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ' + result.user.name);
                document.getElementById('auth-status').textContent = `âœ… ${result.user.name} (${result.user.role})`;
                document.getElementById('auth-status').className = 'mt-2 text-sm text-green-600';
            } else {
                log('âŒ ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: ' + result.message);
                document.getElementById('auth-status').textContent = 'âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—';
                document.getElementById('auth-status').className = 'mt-2 text-sm text-red-600';
            }
        }
        
        function goToDashboard() {
            log('ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ç§»å‹•');
            
            if (!checkAuth()) return;
            
            setTimeout(() => {
                window.open('/admin-dashboard.html', '_blank');
            }, 500);
        }
        
        function goToAllMembers() {
            log('ğŸ‘¥ å…¨ä¼šå“¡ä¸€è¦§ã«ç§»å‹•');
            
            if (!checkAuth()) return;
            
            setTimeout(() => {
                window.open('/admin-members.html', '_blank');
            }, 500);
        }
        
        function goToAtRiskMembers() {
            log('âš ï¸ é›¢è„±äºˆå‚™è»ãƒ•ã‚£ãƒ«ã‚¿ã§ä¼šå“¡ä¸€è¦§ã«ç§»å‹•');
            
            if (!checkAuth()) return;
            
            setTimeout(() => {
                window.open('/admin-members.html?filter=at_risk', '_blank');
            }, 500);
        }
        
        function checkKPI() {
            log('ğŸ“Š KPIæ•°å€¤ã‚’ãƒã‚§ãƒƒã‚¯ä¸­...');
            
            // ä¼šå“¡ãƒ‡ãƒ¼ã‚¿ã‚’å‹•çš„ã«èª­ã¿è¾¼ã‚“ã§KPIã‚’è¨ˆç®—
            const script = document.createElement('script');
            script.src = '/members.js';
            script.onload = function() {
                if (typeof demoMembers !== 'undefined') {
                    const total = demoMembers.length;
                    const students = demoMembers.filter(m => m.all_roles.includes('student')).length;
                    const companies = demoMembers.filter(m => m.all_roles.includes('company')).length;
                    const atRisk = demoMembers.filter(m => m.is_inactive_30d || m.status === 'inactive').length;
                    const heroCertified = demoMembers.filter(m => m.is_hero_certified).length;
                    const heroRate = ((heroCertified / total) * 100).toFixed(1);
                    
                    const kpiInfo = `ç·æ•°:${total} | å­¦ç”Ÿ:${students} | ä¼æ¥­:${companies} | é›¢è„±äºˆå‚™è»:${atRisk} | ãƒ’ãƒ¼ãƒ­ãƒ¼èªå®šç‡:${heroRate}%`;
                    
                    log('ğŸ“Š KPIæ•°å€¤: ' + kpiInfo);
                    document.getElementById('kpi-info').textContent = kpiInfo;
                } else {
                    log('âŒ ä¼šå“¡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—');
                }
            };
            script.onerror = function() {
                log('âŒ members.jsã®èª­ã¿è¾¼ã¿ã«å¤±æ•—');
            };
            document.head.appendChild(script);
        }
        
        function testLogout() {
            log('ğŸšª ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒ†ã‚¹ãƒˆ');
            
            if (window.authManager) {
                window.authManager.logout();
                log('âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå®Œäº†');
                document.getElementById('auth-status').textContent = 'æœªãƒ­ã‚°ã‚¤ãƒ³';
                document.getElementById('auth-status').className = 'mt-2 text-sm text-gray-600';
            } else {
                log('âŒ authManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        }
        
        function checkAuth() {
            if (!window.authManager || !window.authManager.getCurrentUser()) {
                log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ - å…ˆã«ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return false;
            }
            
            const user = window.authManager.getCurrentUser();
            if (user.role !== 'admin') {
                log('âŒ ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™');
                return false;
            }
            
            return true;
        }
        
        // åˆæœŸåŒ–
        window.addEventListener('load', function() {
            log('ğŸš€ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†');
            log('ğŸ“‹ ãƒ†ã‚¹ãƒˆæ‰‹é †: 1.ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ â†’ 2.å„ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ãƒ†ã‚¹ãƒˆ â†’ 3.KPIæ•°å€¤ç¢ºèª â†’ 4.ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ');
            
            // KPIæ•°å€¤ã‚’äº‹å‰ã«å–å¾—
            setTimeout(checkKPI, 1000);
        });
    </script>
</body>
</html>