<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事務局ダッシュボード - NEO Digital Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="/auth.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8'
                        },
                        admin: {
                            50: '#fef2f2',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c'
                        },
                        neo: {
                            50: '#f0f9ff',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1'
                        },
                        admin: {
                            50: '#fdf2f8',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8,0,1,1);
            }
            50% {
                transform: none;
                animation-timing-function: cubic-bezier(0,0,0.2,1);
            }
        }
        .transition-all { transition: all 0.3s ease; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .hero-gradient { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .admin-gradient { background: linear-gradient(135deg, #ec4899 0%, #f472b6 100%); }
        .nps-gradient { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .sortable-ghost { opacity: 0.5; background: #e5e7eb; }
        .card-dragging { transform: rotate(5deg); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .collapsible-content { max-height: 1000px; overflow: hidden; transition: max-height 0.3s ease; }
        .collapsed { max-height: 0; }
        .gauge-container { position: relative; width: 120px; height: 60px; }
        .gauge-bg { stroke: #e5e7eb; stroke-width: 8; fill: none; }
        .gauge-fill { stroke-width: 8; fill: none; transition: stroke-dashoffset 0.3s ease; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 統一ヘッダー: 事務局ダッシュボード -->
    <nav class="bg-white shadow-lg border-b-2 border-admin-500 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- ロゴとタイトル -->
                <div class="flex items-center space-x-4">
                    <div class="admin-gradient text-white p-2 rounded-lg shadow-md">
                        <i class="fas fa-user-tie text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">NEO Digital Platform</h1>
                        <p class="text-sm text-admin-600 font-medium">事務局ダッシュボード</p>
                    </div>
                </div>

                <!-- ナビゲーションメニュー -->
                <div class="hidden lg:flex items-center space-x-6">
                    <a href="/admin/dashboard" class="text-admin-700 font-medium border-b-2 border-admin-500 pb-1">
                        <i class="fas fa-chart-line mr-2"></i>KPI管理
                    </a>
                    <div class="relative" id="members-menu">
                        <button class="text-gray-600 hover:text-admin-600 font-medium transition-colors group flex items-center" onclick="toggleMembersMenu()">
                            <i class="fas fa-users mr-2 group-hover:text-blue-600"></i>会員管理
                            <i class="fas fa-chevron-down ml-1 text-xs transition-transform" id="members-menu-icon"></i>
                        </button>
                        <div class="absolute top-full left-0 mt-1 w-56 bg-white rounded-lg shadow-lg border border-gray-200 z-50 hidden" id="members-dropdown">
                            <div class="py-1">
                                <a href="#" onclick="navigateToMembers(); return false;" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                    <i class="fas fa-list mr-3 text-blue-500"></i>
                                    <div>
                                        <div class="font-medium">全会員一覧</div>
                                        <div class="text-xs text-gray-500">全ての会員を表示・管理</div>
                                    </div>
                                </a>
                                <a href="#" onclick="navigateToAtRiskMembers(); return false;" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-yellow-50 hover:text-yellow-700 transition-colors">
                                    <i class="fas fa-exclamation-triangle mr-3 text-yellow-500"></i>
                                    <div>
                                        <div class="font-medium">離脱予備軍</div>
                                        <div class="text-xs text-gray-500">要注意メンバーのフィルタ表示</div>
                                    </div>
                                </a>
                                <a href="#" onclick="navigateToActiveMembers(); return false;" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 transition-colors">
                                    <i class="fas fa-user-check mr-3 text-green-500"></i>
                                    <div>
                                        <div class="font-medium">アクティブ会員</div>
                                        <div class="text-xs text-gray-500">活動中メンバーのフィルタ表示</div>
                                    </div>
                                </a>
                                <div class="border-t border-gray-100 my-1"></div>
                                <a href="#" onclick="exportMembersFromDashboard(); return false;" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-purple-50 hover:text-purple-700 transition-colors">
                                    <i class="fas fa-download mr-3 text-purple-500"></i>
                                    <div>
                                        <div class="font-medium">会員データ出力</div>
                                        <div class="text-xs text-gray-500">CSV形式でエクスポート</div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <a href="/admin/monitoring" class="text-gray-600 hover:text-admin-600 font-medium transition-colors">
                        <i class="fas fa-server mr-2"></i>システム監視
                    </a>
                    <a href="/admin/settings" class="text-gray-600 hover:text-admin-600 font-medium transition-colors">
                        <i class="fas fa-cog mr-2"></i>設定
                    </a>
                </div>

                <!-- フィルター -->
                <div class="hidden md:flex lg:hidden xl:flex items-center space-x-3">
                    <select id="company-filter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent text-sm">
                        <option value="">全企業</option>
                        <option value="techcorp">テックコーポレーション</option>
                        <option value="innovate">イノベート株式会社</option>
                        <option value="digital">デジタルソリューションズ</option>
                    </select>
                    
                    <select id="member-filter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent text-sm">
                        <option value="">全会員区分</option>
                        <option value="youth">ユース選抜</option>
                        <option value="corporate">企業選抜</option>
                    </select>
                </div>

                <!-- ユーザーメニュー -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="notification-btn" class="relative p-2 text-gray-600 hover:text-admin-600 transition-colors">
                            <i class="fas fa-bell text-xl"></i>
                            <span id="notification-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center animate-bounce">5</span>
                        </button>
                    </div>
                    <div class="relative">
                        <button id="user-menu-btn" class="flex items-center space-x-2 text-gray-700 hover:text-admin-600 transition-colors">
                            <div class="admin-gradient text-white p-2 rounded-full shadow-md">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <span class="font-medium hidden sm:block" id="admin-name">事務局</span>
                            <i class="fas fa-chevron-down text-sm"></i>
                        </button>
                        <!-- ドロップダウンメニュー -->
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50">
                            <a href="/profile.html" class="block px-4 py-2 text-gray-700 hover:bg-admin-50 transition-colors">
                                <i class="fas fa-user-cog mr-2"></i>プロフィール
                            </a>
                            <a href="/admin/settings" class="block px-4 py-2 text-gray-700 hover:bg-admin-50 transition-colors">
                                <i class="fas fa-cog mr-2"></i>設定
                            </a>
                            <button onclick="resetLayout()" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-admin-50 transition-colors">
                                <i class="fas fa-undo mr-2"></i>レイアウトリセット
                            </button>
                            <div class="border-t border-gray-200"></div>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">
                                <i class="fas fa-sign-out-alt mr-2"></i>ログアウト
                            </button>
                        </div>
                    </div>
                    
                    <!-- モバイルメニューボタン -->
                    <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-600 hover:text-admin-600 transition-colors">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- モバイルナビゲーション -->
            <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-gray-200">
                <div class="space-y-2 pt-4">
                    <a href="/admin/dashboard" class="block text-admin-700 font-medium px-2 py-2 rounded bg-admin-50">
                        <i class="fas fa-chart-line mr-3"></i>KPI管理
                    </a>
                    <a href="/admin-members.html" class="block text-gray-600 hover:text-admin-600 px-2 py-2 rounded hover:bg-admin-50 transition-colors group" onclick="navigateToMembers(); return false;">
                        <i class="fas fa-users mr-3 group-hover:text-blue-600"></i>会員一覧
                        <i class="fas fa-external-link-alt text-xs ml-1 opacity-60"></i>
                    </a>
                    <a href="/admin/monitoring" class="block text-gray-600 hover:text-admin-600 px-2 py-2 rounded hover:bg-admin-50 transition-colors">
                        <i class="fas fa-server mr-3"></i>システム監視
                    </a>
                    <a href="/admin/settings" class="block text-gray-600 hover:text-admin-600 px-2 py-2 rounded hover:bg-admin-50 transition-colors">
                        <i class="fas fa-cog mr-3"></i>設定
                    </a>
                    <!-- モバイル用フィルター -->
                    <div class="space-y-2 pt-2 border-t border-gray-200">
                        <select id="mobile-company-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent text-sm">
                            <option value="">全企業</option>
                            <option value="techcorp">テックコーポレーション</option>
                            <option value="innovate">イノベート株式会社</option>
                            <option value="digital">デジタルソリューションズ</option>
                        </select>
                        <select id="mobile-member-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-admin-500 focus:border-transparent text-sm">
                            <option value="">全会員区分</option>
                            <option value="youth">ユース選抜</option>
                            <option value="corporate">企業選抜</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ヘッダー: 全体サマリーKPIカード -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
            <!-- 会員総数 -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-blue-500 hover:shadow-xl transition-shadow cursor-pointer transform hover:scale-105" onclick="navigateToMembers()">
                <div class="text-center">
                    <div class="text-2xl font-bold text-blue-700" id="total-members">247</div>
                    <div class="text-sm text-gray-600 flex items-center justify-center">
                        <i class="fas fa-users mr-1"></i>
                        会員総数
                        <i class="fas fa-external-link-alt text-xs ml-1 opacity-60"></i>
                    </div>
                    <div class="text-xs text-blue-600 mt-1">
                        <span id="student-count">203</span>学生 / <span id="company-count">28</span>企業 / <span id="youth-count">12</span>ユース / <span id="corporate-count">4</span>企業選抜
                    </div>
                    <div class="text-xs text-blue-500 mt-1 opacity-75">
                        クリックで詳細表示
                    </div>
                </div>
            </div>

            <!-- プログラムNPS -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-green-500 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-700" id="nps-score">68</div>
                    <div class="text-sm text-gray-600">NPS</div>
                    <div class="text-xs mt-1">
                        <span class="text-green-600 flex items-center justify-center">
                            <i class="fas fa-arrow-up mr-1"></i>目標≧50
                        </span>
                    </div>
                </div>
            </div>

            <!-- 公認プロジェクト数 -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-purple-500 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-2xl font-bold text-purple-700" id="certified-projects">18</div>
                    <div class="text-sm text-gray-600">公認PJ数</div>
                    <div class="text-xs mt-1">
                        <span class="text-green-600 flex items-center justify-center">
                            <i class="fas fa-check-circle mr-1"></i>目標≧15
                        </span>
                    </div>
                </div>
            </div>

            <!-- ヒーロー認定率 -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-yellow-500 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-2xl font-bold text-yellow-700" id="hero-certification-rate">8.2%</div>
                    <div class="text-sm text-gray-600">ヒーロー認定率</div>
                    <div class="text-xs mt-1">
                        <span class="text-green-600 flex items-center justify-center">
                            <i class="fas fa-trophy mr-1"></i>目標≧5%
                        </span>
                    </div>
                </div>
            </div>

            <!-- 離脱予備軍数 -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-red-500 hover:shadow-xl transition-shadow cursor-pointer transform hover:scale-105" onclick="navigateToAtRiskMembers()">
                <div class="text-center">
                    <div class="text-2xl font-bold text-red-700" id="at-risk-count">7</div>
                    <div class="text-sm text-gray-600 flex items-center justify-center">
                        <i class="fas fa-user-times mr-1"></i>
                        離脱予備軍
                        <i class="fas fa-external-link-alt text-xs ml-1 opacity-60"></i>
                    </div>
                    <div class="text-xs mt-1">
                        <span class="text-red-600 flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle mr-1 animate-bounce"></i>要注意
                        </span>
                    </div>
                    <div class="text-xs text-red-500 mt-1 opacity-75">
                        クリックで詳細表示
                    </div>
                </div>
            </div>

            <!-- Slack活動度 -->
            <div class="bg-white rounded-xl shadow-lg p-4 border-l-4 border-indigo-500 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-2xl font-bold text-indigo-700" id="slack-wau">142</div>
                    <div class="text-sm text-gray-600">Slack WAU</div>
                    <div class="text-xs text-indigo-600 mt-1">
                        <span id="slack-actions">1,247</span> アクション/週
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- メインコンテンツ: ドラッグ&ドロップ可能なセクション -->
    <div class="max-w-7xl mx-auto px-4">
        <div id="sortable-sections" class="space-y-8">
            
            <!-- セクション1: コミュニティ健康度 -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="community-health">
                <div class="section-header bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('community-health')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-heart text-xl"></i>
                            <h3 class="text-lg font-bold">コミュニティ健康度</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('community-health')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="community-health-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="community-health-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 関与度分布 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-blue-500"></i>
                                関与度ステータス分布
                            </h4>
                            <div class="h-64">
                                <canvas id="engagementChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- 推移グラフ -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-line mr-2 text-green-500"></i>
                                月次推移（6か月）
                            </h4>
                            <div class="h-64">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Slack指標 -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-indigo-600 font-medium">週次アクティブユーザー</div>
                                    <div class="text-2xl font-bold text-indigo-700" id="slack-weekly-active">142</div>
                                </div>
                                <i class="fab fa-slack text-2xl text-indigo-500"></i>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-purple-600 font-medium">週次アクション数</div>
                                    <div class="text-2xl font-bold text-purple-700" id="slack-weekly-actions">1,247</div>
                                </div>
                                <i class="fas fa-comments text-2xl text-purple-500"></i>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-sm text-green-600 font-medium">エンゲージメント率</div>
                                    <div class="text-2xl font-bold text-green-700" id="engagement-rate">78.5%</div>
                                </div>
                                <i class="fas fa-heart text-2xl text-green-500"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション2: ヒーローステップ KPI -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="hero-steps">
                <div class="section-header hero-gradient text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('hero-steps')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-trophy text-xl"></i>
                            <h3 class="text-lg font-bold">ヒーローステップ KPI</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('hero-steps')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="hero-steps-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="hero-steps-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 全体ステップ分布 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-bar mr-2 text-yellow-500"></i>
                                全体ステップ分布
                            </h4>
                            <div class="h-64">
                                <canvas id="heroStepsChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- KPIゲージ -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-tachometer-alt mr-2 text-red-500"></i>
                                KPIゲージ
                            </h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-700">3次以上到達率</div>
                                        <div class="text-lg font-bold text-green-700">82.5%</div>
                                        <div class="text-xs text-gray-500">目標: 85%</div>
                                    </div>
                                    <div class="gauge-container">
                                        <svg viewBox="0 0 120 60" class="w-full h-full">
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-bg"/>
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-fill stroke-yellow-500" 
                                                  stroke-dasharray="125.66" stroke-dashoffset="22.19"/>
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-700">4次到達率</div>
                                        <div class="text-lg font-bold text-blue-700">25.0%</div>
                                        <div class="text-xs text-gray-500">目標: 20%</div>
                                    </div>
                                    <div class="gauge-container">
                                        <svg viewBox="0 0 120 60" class="w-full h-full">
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-bg"/>
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-fill stroke-green-500" 
                                                  stroke-dasharray="125.66" stroke-dashoffset="0"/>
                                        </svg>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <div class="text-sm font-medium text-gray-700">5次到達率</div>
                                        <div class="text-lg font-bold text-purple-700">10.0%</div>
                                        <div class="text-xs text-gray-500">目標: 5%</div>
                                    </div>
                                    <div class="gauge-container">
                                        <svg viewBox="0 0 120 60" class="w-full h-full">
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-bg"/>
                                            <path d="M10 50 A 40 40 0 0 1 110 50" class="gauge-fill stroke-green-500" 
                                                  stroke-dasharray="125.66" stroke-dashoffset="0"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 新規ヒーロー候補と承認待ち -->
                    <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 新規ヒーロー候補 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h5 class="text-sm font-semibold text-yellow-800 mb-3 flex items-center">
                                <i class="fas fa-star mr-2"></i>
                                新規ヒーロー候補（直近30日）
                            </h5>
                            <div class="space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="font-medium">田中太郎</span>
                                    <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">3次→4次</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="font-medium">佐藤花子</span>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">4次→5次</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="font-medium">山田次郎</span>
                                    <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">2次→3次</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 承認待ち候補 -->
                        <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                            <h5 class="text-sm font-semibold text-red-800 mb-3 flex items-center">
                                <i class="fas fa-clock mr-2"></i>
                                承認待ち候補
                            </h5>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="text-sm">
                                        <div class="font-medium">鈴木一郎</div>
                                        <div class="text-xs text-gray-500">3次昇進申請</div>
                                    </div>
                                    <div class="flex space-x-1">
                                        <button onclick="approveHero('suzuki-ichiro')" class="bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600">
                                            承認
                                        </button>
                                        <button onclick="rejectHero('suzuki-ichiro')" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                            差戻
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div class="text-sm">
                                        <div class="font-medium">高橋美咲</div>
                                        <div class="text-xs text-gray-500">4次昇進申請</div>
                                    </div>
                                    <div class="flex space-x-1">
                                        <button onclick="approveHero('takahashi-misaki')" class="bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600">
                                            承認
                                        </button>
                                        <button onclick="rejectHero('takahashi-misaki')" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">
                                            差戻
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション3: 授業・イベント運営 -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="classes-events">
                <div class="section-header bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('classes-events')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-chalkboard-teacher text-xl"></i>
                            <h3 class="text-lg font-bold">授業・イベント運営</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('classes-events')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="classes-events-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="classes-events-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- 今週の授業一覧 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-calendar-week mr-2 text-blue-500"></i>
                                今週の授業一覧
                            </h4>
                            <div class="space-y-3">
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium">AI・機械学習入門</div>
                                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">準備完了</span>
                                    </div>
                                    <div class="text-sm text-gray-600 mb-2">担当: 田中教授 | 9月3日 14:00-16:00</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 95%"></div>
                                    </div>
                                    <div class="text-xs text-green-600 mt-1">出席率: 95%</div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium">プロジェクト企画演習</div>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">準備中</span>
                                    </div>
                                    <div class="text-sm text-gray-600 mb-2">担当: 佐藤講師 | 9月4日 10:00-12:00</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 70%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1">準備進捗: 70%</div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium">デザイン思考ワークショップ</div>
                                        <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs">要対応</span>
                                    </div>
                                    <div class="text-sm text-gray-600 mb-2">担当: 山田講師 | 9月5日 13:00-17:00</div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full" style="width: 30%"></div>
                                    </div>
                                    <div class="text-xs text-red-600 mt-1">準備進捗: 30%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 授業後アンケート結果 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-chart-bar mr-2 text-purple-500"></i>
                                授業後アンケート結果
                            </h4>
                            <div class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-blue-800">満足度</span>
                                        <span class="text-xl font-bold text-blue-700">4.2</span>
                                    </div>
                                    <div class="w-full bg-blue-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 84%"></div>
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-green-800">理解度</span>
                                        <span class="text-xl font-bold text-green-700">3.9</span>
                                    </div>
                                    <div class="w-full bg-green-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: 78%"></div>
                                    </div>
                                </div>
                                
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-sm font-medium text-purple-800">推奨度</span>
                                        <span class="text-xl font-bold text-purple-700">4.5</span>
                                    </div>
                                    <div class="w-full bg-purple-200 rounded-full h-2">
                                        <div class="bg-purple-600 h-2 rounded-full" style="width: 90%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- イベント稼働率 -->
                            <div class="mt-6">
                                <h5 class="text-sm font-semibold mb-3 flex items-center">
                                    <i class="fas fa-users mr-2 text-orange-500"></i>
                                    イベント稼働率
                                </h5>
                                <div class="flex justify-between text-sm">
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-green-700">82%</div>
                                        <div class="text-gray-600">参加率</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-red-700">18%</div>
                                        <div class="text-gray-600">欠席率</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-blue-700">95%</div>
                                        <div class="text-gray-600">満足度</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 未準備タスク一覧 -->
                    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h5 class="text-sm font-semibold text-yellow-800 mb-3 flex items-center">
                            <i class="fas fa-tasks mr-2"></i>
                            未準備タスク一覧
                        </h5>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="space-y-2">
                                <h6 class="text-xs font-medium text-red-700">会場準備</h6>
                                <div class="text-sm">
                                    <div class="flex justify-between">
                                        <span>第3会議室セットアップ</span>
                                        <span class="text-red-600">未完</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>AV機器テスト</span>
                                        <span class="text-green-600">完了</span>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <h6 class="text-xs font-medium text-red-700">資料準備</h6>
                                <div class="text-sm">
                                    <div class="flex justify-between">
                                        <span>配布資料印刷</span>
                                        <span class="text-yellow-600">進行中</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>スライド最終確認</span>
                                        <span class="text-red-600">未完</span>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <h6 class="text-xs font-medium text-green-700">登壇者</h6>
                                <div class="text-sm">
                                    <div class="flex justify-between">
                                        <span>講師打ち合わせ</span>
                                        <span class="text-green-600">完了</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>ゲスト確認</span>
                                        <span class="text-green-600">完了</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション4: 相談マッチング管理 -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="consultation-matching">
                <div class="section-header bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('consultation-matching')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-handshake text-xl"></i>
                            <h3 class="text-lg font-bold">相談マッチング管理</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('consultation-matching')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="consultation-matching-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="consultation-matching-content">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 新規相談 -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-blue-800 mb-3 flex items-center justify-between">
                                <span><i class="fas fa-plus-circle mr-2"></i>新規相談</span>
                                <span class="bg-blue-500 text-white rounded-full px-2 py-1 text-xs">3</span>
                            </h4>
                            <div id="new-consultations" class="space-y-3 min-h-[200px]">
                                <div class="consultation-item bg-white border border-blue-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="new-1">
                                    <div class="font-medium text-sm">キャリア相談</div>
                                    <div class="text-xs text-gray-600">田中太郎 → 未アサイン</div>
                                    <div class="text-xs text-blue-600 mt-1">2時間前</div>
                                    <select class="mt-2 text-xs w-full border rounded px-2 py-1" onchange="assignConsultant(this, 'new-1')">
                                        <option value="">担当者選択</option>
                                        <option value="staff1">山田事務局員</option>
                                        <option value="staff2">佐藤事務局員</option>
                                        <option value="staff3">鈴木事務局員</option>
                                    </select>
                                </div>
                                
                                <div class="consultation-item bg-white border border-blue-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="new-2">
                                    <div class="font-medium text-sm">技術相談</div>
                                    <div class="text-xs text-gray-600">佐藤花子 → 未アサイン</div>
                                    <div class="text-xs text-blue-600 mt-1">5時間前</div>
                                    <select class="mt-2 text-xs w-full border rounded px-2 py-1" onchange="assignConsultant(this, 'new-2')">
                                        <option value="">担当者選択</option>
                                        <option value="staff1">山田事務局員</option>
                                        <option value="staff2">佐藤事務局員</option>
                                        <option value="staff3">鈴木事務局員</option>
                                    </select>
                                </div>
                                
                                <div class="consultation-item bg-white border border-blue-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="new-3">
                                    <div class="font-medium text-sm">プロジェクト相談</div>
                                    <div class="text-xs text-gray-600">山田次郎 → 未アサイン</div>
                                    <div class="text-xs text-blue-600 mt-1">1日前</div>
                                    <select class="mt-2 text-xs w-full border rounded px-2 py-1" onchange="assignConsultant(this, 'new-3')">
                                        <option value="">担当者選択</option>
                                        <option value="staff1">山田事務局員</option>
                                        <option value="staff2">佐藤事務局員</option>
                                        <option value="staff3">鈴木事務局員</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 対応中 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-yellow-800 mb-3 flex items-center justify-between">
                                <span><i class="fas fa-clock mr-2"></i>対応中</span>
                                <span class="bg-yellow-500 text-white rounded-full px-2 py-1 text-xs">2</span>
                            </h4>
                            <div id="in-progress-consultations" class="space-y-3 min-h-[200px]">
                                <div class="consultation-item bg-white border border-yellow-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="progress-1">
                                    <div class="font-medium text-sm">企業紹介依頼</div>
                                    <div class="text-xs text-gray-600">高橋美咲 → 山田事務局員</div>
                                    <div class="text-xs text-yellow-600 mt-1">対応中 (開始から2日)</div>
                                </div>
                                
                                <div class="consultation-item bg-white border border-yellow-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="progress-2">
                                    <div class="font-medium text-sm">イベント企画</div>
                                    <div class="text-xs text-gray-600">渡辺由美 → 佐藤事務局員</div>
                                    <div class="text-xs text-yellow-600 mt-1">対応中 (開始から1日)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 解決済み -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-green-800 mb-3 flex items-center justify-between">
                                <span><i class="fas fa-check-circle mr-2"></i>解決済み</span>
                                <span class="bg-green-500 text-white rounded-full px-2 py-1 text-xs">5</span>
                            </h4>
                            <div id="completed-consultations" class="space-y-3 min-h-[200px]">
                                <div class="consultation-item bg-white border border-green-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="completed-1">
                                    <div class="font-medium text-sm">資格取得相談</div>
                                    <div class="text-xs text-gray-600">中村雄大 → 鈴木事務局員</div>
                                    <div class="text-xs text-green-600 mt-1">解決 (5日で完了)</div>
                                </div>
                                
                                <div class="consultation-item bg-white border border-green-300 rounded-lg p-3 cursor-move" draggable="true" data-consultation-id="completed-2">
                                    <div class="font-medium text-sm">学習計画作成</div>
                                    <div class="text-xs text-gray-600">小林直美 → 山田事務局員</div>
                                    <div class="text-xs text-green-600 mt-1">解決 (3日で完了)</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション5: システム・運営状況 -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="system-operations">
                <div class="section-header bg-gradient-to-r from-gray-600 to-gray-700 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('system-operations')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-server text-xl"></i>
                            <h3 class="text-lg font-bold">システム・運営状況</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('system-operations')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="system-operations-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="system-operations-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- API稼働率 -->
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <div class="text-center">
                                <i class="fas fa-check-circle text-2xl text-green-600 mb-2"></i>
                                <div class="text-xl font-bold text-green-700">99.8%</div>
                                <div class="text-sm text-green-600">API稼働率</div>
                                <div class="text-xs text-gray-500 mt-1">24時間</div>
                            </div>
                        </div>
                        
                        <!-- 平均レスポンス -->
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="text-center">
                                <i class="fas fa-tachometer-alt text-2xl text-blue-600 mb-2"></i>
                                <div class="text-xl font-bold text-blue-700">125ms</div>
                                <div class="text-sm text-blue-600">平均レスポンス</div>
                                <div class="text-xs text-gray-500 mt-1">1時間</div>
                            </div>
                        </div>
                        
                        <!-- エラー件数 -->
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle text-2xl text-yellow-600 mb-2"></i>
                                <div class="text-xl font-bold text-yellow-700">3</div>
                                <div class="text-sm text-yellow-600">エラー件数</div>
                                <div class="text-xs text-gray-500 mt-1">24時間</div>
                            </div>
                        </div>
                        
                        <!-- セキュリティ -->
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="text-center">
                                <i class="fas fa-shield-alt text-2xl text-purple-600 mb-2"></i>
                                <div class="text-xl font-bold text-purple-700">85</div>
                                <div class="text-sm text-purple-600">セキュリティ評価</div>
                                <div class="text-xs text-gray-500 mt-1">最新</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- アラート一覧 -->
                    <div class="mt-6">
                        <h4 class="text-md font-semibold mb-4 flex items-center">
                            <i class="fas fa-bell mr-2 text-red-500"></i>
                            アラート一覧
                        </h4>
                        <div class="space-y-3">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-3 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-times-circle text-red-600"></i>
                                    <div>
                                        <div class="text-sm font-medium text-red-800">バックアップ失敗</div>
                                        <div class="text-xs text-red-600">日次バックアップでエラーが発生しました</div>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500">2時間前</div>
                            </div>
                            
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                                    <div>
                                        <div class="text-sm font-medium text-yellow-800">CSP違反検出</div>
                                        <div class="text-xs text-yellow-600">外部スクリプトの読み込み試行を検出</div>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500">4時間前</div>
                            </div>
                            
                            <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-ban text-orange-600"></i>
                                    <div>
                                        <div class="text-sm font-medium text-orange-800">Rate Limit到達</div>
                                        <div class="text-xs text-orange-600">API呼び出し制限に達しました (IP: 192.168.1.100)</div>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500">6時間前</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション6: 広報・発信管理 -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="pr-management">
                <div class="section-header bg-gradient-to-r from-pink-500 to-pink-600 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('pr-management')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-bullhorn text-xl"></i>
                            <h3 class="text-lg font-bold">広報・発信管理</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('pr-management')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="pr-management-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="pr-management-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- SNS投稿スケジュール -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fab fa-twitter mr-2 text-blue-500"></i>
                                SNS投稿スケジュール
                            </h4>
                            <div class="space-y-3">
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium text-sm">ヒーロー認定の告知</div>
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">予約済み</span>
                                    </div>
                                    <div class="text-xs text-gray-600 mb-2">
                                        <i class="fab fa-twitter mr-1"></i>Twitter | 9月3日 15:00
                                    </div>
                                    <div class="text-xs text-gray-700">「新たなヒーローが誕生しました！」</div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium text-sm">イベント募集開始</div>
                                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">投稿済み</span>
                                    </div>
                                    <div class="text-xs text-gray-600 mb-2">
                                        <i class="fab fa-linkedin mr-1"></i>LinkedIn | 9月2日 10:00
                                    </div>
                                    <div class="text-xs text-gray-700">「デザイン思考ワークショップ参加者募集」</div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <div class="flex justify-between items-start mb-2">
                                        <div class="font-medium text-sm">学習成果の紹介</div>
                                        <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-xs">下書き</span>
                                    </div>
                                    <div class="text-xs text-gray-600 mb-2">
                                        <i class="fab fa-facebook mr-1"></i>Facebook | 9月4日 12:00
                                    </div>
                                    <div class="text-xs text-gray-700">「NEO生の素晴らしいプロジェクト成果を...」</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 広報企画進捗 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-tasks mr-2 text-green-500"></i>
                                広報企画進捗
                            </h4>
                            <div class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="font-medium text-sm">年次報告書作成</div>
                                        <span class="text-blue-700 font-bold">75%</span>
                                    </div>
                                    <div class="w-full bg-blue-200 rounded-full h-2">
                                        <div class="bg-blue-600 h-2 rounded-full" style="width: 75%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1">締切: 9月15日</div>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="font-medium text-sm">プロモーション動画制作</div>
                                        <span class="text-green-700 font-bold">40%</span>
                                    </div>
                                    <div class="w-full bg-green-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: 40%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1">締切: 9月30日</div>
                                </div>
                                
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                                    <div class="flex justify-between items-center mb-2">
                                        <div class="font-medium text-sm">Webサイトリニューアル</div>
                                        <span class="text-purple-700 font-bold">60%</span>
                                    </div>
                                    <div class="w-full bg-purple-200 rounded-full h-2">
                                        <div class="bg-purple-600 h-2 rounded-full" style="width: 60%"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 mt-1">締切: 10月10日</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 外部露出 -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-4 text-center">
                            <i class="fas fa-eye text-2xl text-orange-600 mb-2"></i>
                            <div class="text-xl font-bold text-orange-700">12,547</div>
                            <div class="text-sm text-orange-600">記事PV</div>
                            <div class="text-xs text-gray-500 mt-1">今月</div>
                        </div>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                            <i class="fas fa-share-alt text-2xl text-blue-600 mb-2"></i>
                            <div class="text-xl font-bold text-blue-700">8,923</div>
                            <div class="text-sm text-blue-600">SNSリーチ</div>
                            <div class="text-xs text-gray-500 mt-1">今週</div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                            <i class="fas fa-newspaper text-2xl text-green-600 mb-2"></i>
                            <div class="text-xl font-bold text-green-700">5</div>
                            <div class="text-sm text-green-600">メディア掲載</div>
                            <div class="text-xs text-gray-500 mt-1">今月</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- セクション7: 設定・カスタマイズ -->
            <div class="section-card bg-white rounded-xl shadow-lg" data-section="settings-customization">
                <div class="section-header bg-gradient-to-r from-indigo-500 to-indigo-600 text-white p-4 rounded-t-xl cursor-pointer" onclick="toggleSection('settings-customization')">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-cog text-xl"></i>
                            <h3 class="text-lg font-bold">設定・カスタマイズ</h3>
                            <i class="fas fa-grip-vertical text-sm opacity-50 drag-handle cursor-move"></i>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="exportSection('settings-customization')" class="text-white/80 hover:text-white transition-colors">
                                <i class="fas fa-download"></i>
                            </button>
                            <i class="fas fa-chevron-down transition-transform" id="settings-customization-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="collapsible-content p-6" id="settings-customization-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- レイアウト設定 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-layout text-lg mr-2 text-indigo-500"></i>
                                レイアウト設定
                            </h4>
                            <div class="space-y-3">
                                <button onclick="saveLayout()" class="w-full bg-indigo-500 text-white py-2 px-4 rounded-lg hover:bg-indigo-600 transition-colors">
                                    <i class="fas fa-save mr-2"></i>現在のレイアウトを保存
                                </button>
                                
                                <button onclick="resetLayout()" class="w-full bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors">
                                    <i class="fas fa-undo mr-2"></i>デフォルトレイアウトに戻す
                                </button>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <h5 class="text-sm font-medium mb-2">テンプレート</h5>
                                    <div class="space-y-2">
                                        <button onclick="applyTemplate('focus-hero')" class="w-full text-left bg-yellow-50 hover:bg-yellow-100 px-3 py-2 rounded text-sm transition-colors">
                                            <i class="fas fa-trophy mr-2 text-yellow-600"></i>ヒーロー重視レイアウト
                                        </button>
                                        <button onclick="applyTemplate('focus-operation')" class="w-full text-left bg-green-50 hover:bg-green-100 px-3 py-2 rounded text-sm transition-colors">
                                            <i class="fas fa-chalkboard-teacher mr-2 text-green-600"></i>運営重視レイアウト
                                        </button>
                                        <button onclick="applyTemplate('focus-analysis')" class="w-full text-left bg-blue-50 hover:bg-blue-100 px-3 py-2 rounded text-sm transition-colors">
                                            <i class="fas fa-chart-line mr-2 text-blue-600"></i>分析重視レイアウト
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 表示設定 -->
                        <div>
                            <h4 class="text-md font-semibold mb-4 flex items-center">
                                <i class="fas fa-eye text-lg mr-2 text-purple-500"></i>
                                表示設定
                            </h4>
                            <div class="space-y-3">
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <h5 class="text-sm font-medium mb-3">セクション表示</h5>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('community-health', this)">
                                            <span class="text-sm">コミュニティ健康度</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('hero-steps', this)">
                                            <span class="text-sm">ヒーローステップ KPI</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('classes-events', this)">
                                            <span class="text-sm">授業・イベント運営</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('consultation-matching', this)">
                                            <span class="text-sm">相談マッチング管理</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('system-operations', this)">
                                            <span class="text-sm">システム・運営状況</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2" onchange="toggleSectionVisibility('pr-management', this)">
                                            <span class="text-sm">広報・発信管理</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-3">
                                    <h5 class="text-sm font-medium mb-3">自動更新設定</h5>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2">
                                            <span class="text-sm">リアルタイム更新 (30秒間隔)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" checked class="mr-2">
                                            <span class="text-sm">アラート通知</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" class="mr-2">
                                            <span class="text-sm">サウンド通知</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- エクスポート設定 -->
                    <div class="mt-6 border border-gray-200 rounded-lg p-4">
                        <h4 class="text-md font-semibold mb-4 flex items-center">
                            <i class="fas fa-download mr-2 text-green-500"></i>
                            データエクスポート
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="text-sm font-medium mb-2">レポート形式</h5>
                                <div class="space-y-2">
                                    <button onclick="exportReport('csv')" class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                                        <i class="fas fa-file-csv mr-2"></i>CSV形式でエクスポート
                                    </button>
                                    <button onclick="exportReport('pdf')" class="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm">
                                        <i class="fas fa-file-pdf mr-2"></i>PDF形式でエクスポート（理事会用）
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h5 class="text-sm font-medium mb-2">エクスポート範囲</h5>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                    <option value="current">現在の表示データ</option>
                                    <option value="filtered">フィルタ適用データ</option>
                                    <option value="all">全データ</option>
                                </select>
                                <div class="mt-2">
                                    <label class="flex items-center text-sm">
                                        <input type="checkbox" class="mr-2">
                                        <span>詳細分析データを含む</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- エクスポート・操作用の隠しフォーム -->
    <div id="export-forms" class="hidden">
        <form id="csv-export-form" method="post" action="/api/export/csv"></form>
        <form id="pdf-export-form" method="post" action="/api/export/pdf"></form>
    </div>

    <script>
        // フィーチャーフラグ設定
        window.FEATURE_ENGAGEMENT_V2 = true; // 実データ注入を有効化
        
        // 認証チェック
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔐 事務局ダッシュボード - 認証チェック');
            
            if (!window.authManager) {
                console.log('🔧 authManager初期化中...');
                window.authManager = new AuthManager();
            }
            
            // 認証状態をチェック（auth.jsの標準メソッドを使用）
            if (!window.authManager.isAuthenticated()) {
                console.log('❌ 未認証 - ログインページにリダイレクト');
                window.location.href = '/login.html';
                return;
            }
            
            const currentUser = window.authManager.getCurrentUser();
            console.log('👤 Current user:', currentUser);
            
            // NEO v2.1では全ロールがダッシュボードアクセス可能
            // 管理者権限チェックをスキップ
            
            console.log('✅ 事務局権限確認済み');
            
            // 管理者名を表示
            const adminName = document.getElementById('admin-name');
            if (adminName && currentUser.name) {
                adminName.textContent = currentUser.name;
            }
            
            // ダッシュボードの初期化
            initializeDashboard();
        });

        // ダッシュボード初期化
        function initializeDashboard() {
            console.log('📊 事務局ダッシュボード初期化');
            
            // チャートの初期化
            initializeCharts();
            
            // ドラッグ&ドロップの設定
            setupDragAndDrop();
            
            // フィルターの設定
            setupFilters();
            
            // リアルタイム更新の開始
            startRealTimeUpdates();
            
            // イベントリスナーの設定
            setupEventListeners();
            
            // 保存されたレイアウトの復元
            restoreLayout();
        }

        // チャートの初期化
        function initializeCharts() {
            // 関与度分布チャート
            const engagementCtx = document.getElementById('engagementChart').getContext('2d');
            new Chart(engagementCtx, {
                type: 'doughnut',
                data: {
                    labels: ['コア', 'アクティブ', '周辺', '離脱予備軍'],
                    datasets: [{
                        data: [25, 45, 23, 7],
                        backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 10, usePointStyle: true, font: { size: 11 } }
                        }
                    }
                }
            });

            // 推移チャート
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['4月', '5月', '6月', '7月', '8月', '9月'],
                    datasets: [
                        {
                            label: 'アクティブ',
                            data: [40, 42, 45, 47, 46, 45],
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: '離脱予備軍',
                            data: [10, 8, 9, 7, 6, 7],
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: { beginAtZero: true, max: 50 }
                    }
                }
            });

            // ヒーローステップチャート
            const heroStepsCtx = document.getElementById('heroStepsChart').getContext('2d');
            new Chart(heroStepsCtx, {
                type: 'bar',
                data: {
                    labels: ['0次', '1次', '2次', '3次', '4次', '5次'],
                    datasets: [{
                        label: '人数',
                        data: [15, 25, 30, 20, 8, 2],
                        backgroundColor: ['#94a3b8', '#60a5fa', '#34d399', '#fbbf24', '#f87171', '#a855f7'],
                        borderWidth: 1,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // ドラッグ&ドロップの設定
        function setupDragAndDrop() {
            // セクションのドラッグ&ドロップ
            const sortable = Sortable.create(document.getElementById('sortable-sections'), {
                animation: 150,
                handle: '.drag-handle',
                ghostClass: 'sortable-ghost',
                chosenClass: 'card-dragging',
                onEnd: function(evt) {
                    console.log('📦 セクション順序変更:', evt.oldIndex, '->', evt.newIndex);
                    saveLayout();
                }
            });

            // 相談マッチングのドラッグ&ドロップ
            setupConsultationDragDrop();
        }

        // 相談マッチングのドラッグ&ドロップ設定
        function setupConsultationDragDrop() {
            const consultationColumns = ['new-consultations', 'in-progress-consultations', 'completed-consultations'];
            
            consultationColumns.forEach(columnId => {
                new Sortable(document.getElementById(columnId), {
                    group: 'consultation',
                    animation: 150,
                    onAdd: function(evt) {
                        const item = evt.item;
                        const fromColumn = evt.from.id;
                        const toColumn = evt.to.id;
                        
                        console.log(`📋 相談ステータス変更: ${fromColumn} → ${toColumn}`);
                        updateConsultationStatus(item.dataset.consultationId, toColumn);
                    }
                });
            });
        }

        // 相談ステータス更新
        function updateConsultationStatus(consultationId, newStatus) {
            const statusMap = {
                'new-consultations': 'new',
                'in-progress-consultations': 'in-progress', 
                'completed-consultations': 'completed'
            };
            
            // APIに送信（モック）
            console.log(`📋 API呼び出し: 相談ID ${consultationId} のステータスを ${statusMap[newStatus]} に更新`);
            
            // 成功通知（モック）
            showNotification('相談ステータスが更新されました', 'success');
        }

        // フィルター設定
        function setupFilters() {
            const filters = ['company-filter', 'member-filter', 'program-filter'];
            
            filters.forEach(filterId => {
                const filter = document.getElementById(filterId);
                if (filter) {
                    filter.addEventListener('change', function() {
                        console.log(`🔍 フィルター変更: ${filterId} = ${this.value}`);
                        applyFilters();
                    });
                }
            });
        }

        // フィルター適用
        function applyFilters() {
            const companyFilter = document.getElementById('company-filter').value;
            const memberFilter = document.getElementById('member-filter').value;
            const programFilter = document.getElementById('program-filter').value;
            
            console.log('🔍 フィルター適用:', { companyFilter, memberFilter, programFilter });
            
            // 全セクションにフィルターを適用
            updateDashboardData({
                company: companyFilter,
                member: memberFilter,
                program: programFilter
            });
        }

        // ダッシュボードデータ更新
        function updateDashboardData(filters) {
            // KPI カードの更新
            updateKPICards(filters);
            
            // チャートの更新
            updateCharts(filters);
            
            // その他のセクションデータ更新
            console.log('📊 ダッシュボードデータ更新完了');
        }

        // KPI カード更新
        function updateKPICards(filters) {
            // モックデータでの更新例
            if (filters.company === 'techcorp') {
                document.getElementById('total-members').textContent = '89';
                document.getElementById('student-count').textContent = '75';
                document.getElementById('nps-score').textContent = '72';
            } else {
                document.getElementById('total-members').textContent = '247';
                document.getElementById('student-count').textContent = '203';
                document.getElementById('nps-score').textContent = '68';
            }
        }

        // チャート更新
        function updateCharts(filters) {
            // 実装：フィルターに基づいてチャートデータを更新
            console.log('📈 チャートデータ更新');
        }

        // セクション開閉
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('collapsed');
                icon.style.transform = 'rotate(-90deg)';
            }
            
            // 状態を保存
            localStorage.setItem(`section-${sectionId}-collapsed`, content.classList.contains('collapsed'));
        }

        // セクション表示/非表示切り替え
        function toggleSectionVisibility(sectionId, checkbox) {
            const section = document.querySelector(`[data-section="${sectionId}"]`);
            if (section) {
                section.style.display = checkbox.checked ? 'block' : 'none';
                localStorage.setItem(`section-${sectionId}-visible`, checkbox.checked);
            }
        }

        // ヒーロー承認/差戻
        function approveHero(heroId) {
            console.log(`✅ ヒーロー承認: ${heroId}`);
            showNotification('ヒーローが承認されました', 'success');
            // 実装: API呼び出し
        }

        function rejectHero(heroId) {
            console.log(`❌ ヒーロー差戻: ${heroId}`);
            showNotification('申請が差し戻されました', 'warning');
            // 実装: API呼び出し
        }

        // 担当者アサイン
        function assignConsultant(select, consultationId) {
            const consultant = select.value;
            if (consultant) {
                console.log(`👤 担当者アサイン: 相談ID ${consultationId} → ${consultant}`);
                showNotification('担当者がアサインされました', 'success');
            }
        }

        // レイアウト管理
        function saveLayout() {
            const sections = Array.from(document.querySelectorAll('#sortable-sections .section-card')).map(el => ({
                id: el.dataset.section,
                collapsed: el.querySelector('.collapsible-content').classList.contains('collapsed'),
                visible: el.style.display !== 'none'
            }));
            
            localStorage.setItem('dashboard-layout', JSON.stringify(sections));
            showNotification('レイアウトを保存しました', 'success');
        }

        function restoreLayout() {
            const saved = localStorage.getItem('dashboard-layout');
            if (saved) {
                const layout = JSON.parse(saved);
                // 実装: レイアウト復元ロジック
                console.log('📐 保存されたレイアウトを復元');
            }
        }

        function resetLayout() {
            localStorage.removeItem('dashboard-layout');
            location.reload();
        }

        function applyTemplate(templateName) {
            console.log(`📋 テンプレート適用: ${templateName}`);
            // 実装: テンプレート適用ロジック
            showNotification(`${templateName} テンプレートを適用しました`, 'success');
        }

        // エクスポート機能
        function exportSection(sectionId) {
            console.log(`📊 セクションエクスポート: ${sectionId}`);
            // 実装: セクション個別エクスポート
        }

        function exportReport(format) {
            console.log(`📊 レポートエクスポート: ${format}`);
            const form = document.getElementById(`${format}-export-form`);
            if (form) {
                form.submit();
            }
        }

        // リアルタイム更新
        function startRealTimeUpdates() {
            console.log('🔄 リアルタイム更新開始');
            
            // 30秒ごとにKPI更新
            setInterval(updateKPIs, 30000);
            
            // 60秒ごとにシステム状況更新
            setInterval(updateSystemStatus, 60000);
        }

        function updateKPIs() {
            // NPSスコアの変動例
            const npsElement = document.getElementById('nps-score');
            const currentNPS = parseInt(npsElement.textContent);
            const variation = Math.floor(Math.random() * 3) - 1; // -1, 0, 1
            const newNPS = Math.max(0, Math.min(100, currentNPS + variation));
            npsElement.textContent = newNPS;
            
            // Slack活動データの更新
            const wauElement = document.getElementById('slack-wau');
            const actionsElement = document.getElementById('slack-actions');
            if (wauElement && actionsElement) {
                const wauVariation = Math.floor(Math.random() * 10) - 5;
                const actionsVariation = Math.floor(Math.random() * 100) - 50;
                
                wauElement.textContent = Math.max(0, parseInt(wauElement.textContent) + wauVariation);
                actionsElement.textContent = Math.max(0, parseInt(actionsElement.textContent.replace(',', '')) + actionsVariation).toLocaleString();
            }
        }

        function updateSystemStatus() {
            // システム稼働率などのリアルタイム更新
            console.log('⚡ システム状況更新');
        }

        // 通知システム
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
                type === 'success' ? 'bg-green-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center space-x-2">
                    <i class="fas ${
                        type === 'success' ? 'fa-check-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' :
                        type === 'error' ? 'fa-times-circle' :
                        'fa-info-circle'
                    }"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // イベントリスナー設定
        function setupEventListeners() {
            // ユーザーメニューの切り替え
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userMenu = document.getElementById('user-menu');
            if (userMenuBtn && userMenu) {
                userMenuBtn.addEventListener('click', function() {
                    userMenu.classList.toggle('hidden');
                });
            }
            
            // 通知ボタン
            const notificationBtn = document.getElementById('notification-btn');
            if (notificationBtn) {
                notificationBtn.addEventListener('click', function() {
                    showNotification('新しい通知があります', 'info');
                });
            }
            
            // 外側クリックでメニューを閉じる
            document.addEventListener('click', function(e) {
                // ユーザーメニューを閉じる
                if (userMenu && !userMenuBtn.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.add('hidden');
                }
                
                // 会員管理メニューを閉じる
                const membersMenu = document.getElementById('members-menu');
                const membersDropdown = document.getElementById('members-dropdown');
                const membersIcon = document.getElementById('members-menu-icon');
                
                if (membersMenu && membersDropdown && !membersMenu.contains(e.target)) {
                    membersDropdown.classList.add('hidden');
                    if (membersIcon) {
                        membersIcon.style.transform = 'rotate(0deg)';
                    }
                }
            });
        }

        // ログアウト機能
        function logout() {
            console.log('👋 ログアウト中...');
            
            if (window.authManager) {
                window.authManager.logout();
            }
            
            window.location.href = '/login.html';
        }

        // 会員一覧ページへのナビゲーション
        function navigateToMembers() {
            console.log('📊 会員一覧ページに移動');
            
            // 認証チェック
            if (!window.authManager || !window.authManager.getCurrentUser()) {
                showNotification('ログインが必要です', 'warning');
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 2000);
                return;
            }
            
            const currentUser = window.authManager.getCurrentUser();
            if (currentUser.role !== 'admin') {
                showNotification('管理者権限が必要です', 'error');
                return;
            }
            
            showNotification('会員一覧ページに移動中...', 'info');
            setTimeout(() => {
                window.location.href = '/admin-members.html';
            }, 1000);
        }

        // 離脱予備軍会員一覧へのナビゲーション
        function navigateToAtRiskMembers() {
            console.log('⚠️ 離脱予備軍会員一覧に移動');
            
            // 認証チェック
            if (!window.authManager || !window.authManager.getCurrentUser()) {
                showNotification('ログインが必要です', 'warning');
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 2000);
                return;
            }
            
            const currentUser = window.authManager.getCurrentUser();
            if (currentUser.role !== 'admin') {
                showNotification('管理者権限が必要です', 'error');
                return;
            }
            
            showNotification('離脱予備軍フィルタを適用して会員一覧に移動中...', 'info');
            setTimeout(() => {
                // 離脱予備軍フィルタを適用したURLパラメータで遷移
                window.location.href = '/admin-members.html?filter=at_risk';
            }, 1000);
        }

        // アクティブ会員一覧へのナビゲーション
        function navigateToActiveMembers() {
            console.log('✅ アクティブ会員一覧に移動');
            
            // 認証チェック
            if (!window.authManager || !window.authManager.getCurrentUser()) {
                showNotification('ログインが必要です', 'warning');
                setTimeout(() => {
                    window.location.href = '/login.html';
                }, 2000);
                return;
            }
            
            const currentUser = window.authManager.getCurrentUser();
            if (currentUser.role !== 'admin') {
                showNotification('管理者権限が必要です', 'error');
                return;
            }
            
            showNotification('アクティブフィルタを適用して会員一覧に移動中...', 'info');
            setTimeout(() => {
                // アクティブフィルタを適用したURLパラメータで遷移
                window.location.href = '/admin-members.html?filter=active';
            }, 1000);
        }

        // ダッシュボードから会員データ出力
        function exportMembersFromDashboard() {
            console.log('📊 ダッシュボードから会員データ出力');
            
            // 認証チェック
            if (!window.authManager || !window.authManager.getCurrentUser()) {
                showNotification('ログインが必要です', 'warning');
                return;
            }
            
            const currentUser = window.authManager.getCurrentUser();
            if (currentUser.role !== 'admin') {
                showNotification('管理者権限が必要です', 'error');
                return;
            }
            
            showNotification('会員データを出力中...', 'info');
            
            // 会員一覧ページのCSV出力機能を利用
            setTimeout(() => {
                window.open('/admin-members.html?action=csv_export', '_blank');
            }, 1000);
        }

        // 会員管理メニューの切り替え
        function toggleMembersMenu() {
            const dropdown = document.getElementById('members-dropdown');
            const icon = document.getElementById('members-menu-icon');
            
            if (dropdown && icon) {
                const isHidden = dropdown.classList.contains('hidden');
                
                if (isHidden) {
                    dropdown.classList.remove('hidden');
                    icon.style.transform = 'rotate(180deg)';
                } else {
                    dropdown.classList.add('hidden');
                    icon.style.transform = 'rotate(0deg)';
                }
            }
        }

        // KPI数値を会員一覧と同期
        function syncKPIWithMembers() {
            console.log('📊 KPI数値を会員データと同期中...');
            
            // デモ用の会員データから実際のKPIを計算
            if (typeof demoMembers !== 'undefined') {
                const totalMembers = demoMembers.length;
                const studentCount = demoMembers.filter(m => m.all_roles.includes('student')).length;
                const companyCount = demoMembers.filter(m => m.all_roles.includes('company')).length;
                const youthCount = demoMembers.filter(m => m.membership_types.includes('youth_selected')).length;
                const corporateCount = demoMembers.filter(m => m.membership_types.includes('company_selected')).length;
                const atRiskCount = demoMembers.filter(m => m.is_inactive_30d || m.status === 'inactive').length;
                const heroCertifiedCount = demoMembers.filter(m => m.is_hero_certified).length;
                const heroCertificationRate = totalMembers > 0 ? ((heroCertifiedCount / totalMembers) * 100).toFixed(1) : '0.0';
                
                // DOM要素を更新
                const totalMembersEl = document.getElementById('total-members');
                const studentCountEl = document.getElementById('student-count');
                const companyCountEl = document.getElementById('company-count');
                const youthCountEl = document.getElementById('youth-count');
                const corporateCountEl = document.getElementById('corporate-count');
                const atRiskCountEl = document.getElementById('at-risk-count');
                const heroCertificationRateEl = document.getElementById('hero-certification-rate');
                
                if (totalMembersEl) totalMembersEl.textContent = totalMembers;
                if (studentCountEl) studentCountEl.textContent = studentCount;
                if (companyCountEl) companyCountEl.textContent = companyCount;
                if (youthCountEl) youthCountEl.textContent = youthCount;
                if (corporateCountEl) corporateCountEl.textContent = corporateCount;
                if (atRiskCountEl) atRiskCountEl.textContent = atRiskCount;
                if (heroCertificationRateEl) heroCertificationRateEl.textContent = heroCertificationRate + '%';
                
                console.log('✅ KPI数値同期完了:', {
                    total: totalMembers,
                    student: studentCount,
                    company: companyCount,
                    atRisk: atRiskCount,
                    heroCertification: heroCertificationRate + '%'
                });
            }
        }

        // ページ読み込み時にKPI同期
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔄 ダッシュボード初期化開始');
            
            // members.jsが読み込まれるまで待機してからKPI同期
            const checkMembersData = () => {
                if (typeof demoMembers !== 'undefined') {
                    syncKPIWithMembers();
                } else {
                    console.log('📊 会員データ待機中...');
                    setTimeout(checkMembersData, 1000);
                }
            };
            
            // members.jsを動的に読み込み
            const script = document.createElement('script');
            script.src = '/members.js';
            script.onload = function() {
                console.log('✅ 会員データ読み込み完了');
                setTimeout(checkMembersData, 500);
            };
            script.onerror = function() {
                console.log('⚠️ 会員データ読み込み失敗 - デフォルト値を使用');
            };
            document.head.appendChild(script);
        });

        console.log('🚀 NEO Digital Platform - 事務局ダッシュボード');
        console.log('🎯 KPI起点の統合管理システムが利用可能です');
    </script>
    
    <!-- ダッシュボード分析機能 -->
    <script src="/js/dashboard-analytics.js"></script>
    
    <!-- 関与度チャート実データアダプター -->
    <script src="/js/engagement-chart-adapter.js" defer></script>
</body>
</html>